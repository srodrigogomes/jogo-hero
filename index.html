<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Hero</title>
    <!-- Carrega a biblioteca Tone.js para √°udio -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>

    <style>
        /* --- Configura√ß√µes Globais e Fundo --- */
        :root {
            --col-1: #4CAF50; /* Verde */
            --col-2: #F44336; /* Vermelho */
            --col-3: #FFEB3B; /* Amarelo */
            --col-4: #2196F3; /* Azul */
            --hit-zone-height: 100px;
            --key-size: 80px;
            --game-area-bottom-padding: 50px; /* Espa√ßo abaixo da zona de acerto */
        }

        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #121212;
            color: white;
            overflow: hidden;
            user-select: none; /* Impede a sele√ß√£o de texto */
        }

        /* Anima√ß√£o de fundo simples */
        body {
            background: linear-gradient(-45deg, #0a0a0a, #1a1a1a, #0a0a0a, #2a2a2a);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Cont√™iner Principal --- */
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- Telas de Overlay (Menu, Fim de Jogo, etc.) --- */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s 0.5s, opacity 0.5s linear;
        }

        .screen.visible {
            visibility: visible;
            opacity: 1;
            transition-delay: 0s;
        }

        .screen h1 {
            font-size: 4em;
            margin-bottom: 0;
            text-shadow: 0 0 15px #fff, 0 0 25px var(--col-4);
        }

        .screen h2 {
            font-size: 3em;
        }

        .screen p {
            font-size: 1.5em;
        }

        .screen button {
            font-size: 1.5em;
            padding: 15px 30px;
            background-color: #333;
            color: white;
            border: 2px solid white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 20px;
        }

        .screen button:hover {
            background-color: white;
            color: black;
            box-shadow: 0 0 20px white;
        }

        /* --- Tela Principal do Jogo --- */
        #game-screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            visibility: hidden; /* Controlado por JS, n√£o pela classe 'visible' */
        }

        /* --- UI (Pontua√ß√£o, Fase, Vida) --- */
        #ui-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            font-size: 1.8em;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.3);
            text-shadow: 0 0 5px #000;
        }

        #health {
            font-size: 1.5em;
            color: #F44336; /* Vermelho */
            letter-spacing: 4px;
        }
        
        #score, #level {
            width: 33%;
        }
        #score { text-align: left; }
        #level { text-align: center; }
        #health { text-align: right; }

        /* --- √Årea do Jogo (Trilhas e Notas) --- */
        #game-area {
            flex-grow: 1;
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            background: rgba(20, 20, 20, 0.5);
            border-left: 2px solid rgba(255, 255, 255, 0.3);
            border-right: 2px solid rgba(255, 255, 255, 0.3);
            overflow: hidden; /* Notas desaparecem no topo */
            /* Perspectiva para efeito 3D (opcional, mas legal) */
            /* perspective: 400px; */
        }

        .track {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 25%;
            border-right: 1px dashed rgba(255, 255, 255, 0.2);
            box-sizing: border-box;
        }

        .track:nth-child(1) { left: 0; }
        .track:nth-child(2) { left: 25%; }
        .track:nth-child(3) { left: 50%; }
        .track:nth-child(4) { left: 75%; border-right: none; }

        /* --- Zona de Acerto e Teclas --- */
        #hit-zone {
            position: absolute;
            bottom: var(--game-area-bottom-padding);
            width: 100%;
            height: var(--hit-zone-height);
            /* Linha de acerto "perfeito" */
            border-top: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 -5px 20px rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 1%; /* Espa√ßamento para as teclas */
            box-sizing: border-box;
        }

        .key {
            width: 23%;
            height: var(--key-size);
            border-radius: 50%; /* C√≠rculos */
            border: 3px solid rgba(255, 255, 255, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.05s ease;
        }

        /* Cores das teclas */
        .key[data-key="a"] { border-color: var(--col-1); }
        .key[data-key="s"] { border-color: var(--col-2); }
        .key[data-key="k"] { border-color: var(--col-3); }
        .key[data-key="l"] { border-color: var(--col-4); }

        /* Efeito de tecla pressionada */
        .key.active {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 20px white;
        }
        .key[data-key="a"].active { background-color: var(--col-1); box-shadow: 0 0 20px var(--col-1); }
        .key[data-key="s"].active { background-color: var(--col-2); box-shadow: 0 0 20px var(--col-2); }
        .key[data-key="k"].active { background-color: var(--col-3); box-shadow: 0 0 20px var(--col-3); }
        .key[data-key="l"].active { background-color: var(--col-4); box-shadow: 0 0 20px var(--col-4); }


        /* --- Notas Caindo --- */
        .note {
            position: absolute;
            width: 23%; /* Um pouco menor que a trilha */
            margin-left: 1%; /* Centraliza a nota na trilha */
            height: 40px;
            border-radius: 50%; /* C√≠rculo */
            top: -40px; /* Come√ßa fora da tela */
            box-sizing: border-box;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            transition: top 0s linear; /* Movimento controlado por JS */
        }

        /* Cores das notas */
        .note[data-col="0"] { background-color: var(--col-1); box-shadow: 0 0 15px var(--col-1); }
        .note[data-col="1"] { background-color: var(--col-2); box-shadow: 0 0 15px var(--col-2); }
        .note[data-col="2"] { background-color: var(--col-3); box-shadow: 0 0 15px var(--col-3); }
        .note[data-col="3"] { background-color: var(--col-4); box-shadow: 0 0 15px var(--col-4); }

        /* --- Barra de Progresso --- */
        #progress-bar-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            height: 10px;
            background-color: #333;
            border-radius: 5px;
            margin-top: 10px;
            margin-bottom: 20px;
        }

        #progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--col-1), var(--col-3), var(--col-4));
            border-radius: 5px;
            transition: width 0.2s linear;
        }
        
        /* --- Feedback Visual (Pop-ups) --- */
        .hit-feedback {
            position: absolute;
            bottom: calc(var(--hit-zone-height) + var(--game-area-bottom-padding) + 20px);
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            font-weight: bold;
            opacity: 0;
            animation: fadeUp 0.5s ease-out;
            pointer-events: none;
        }

        @keyframes fadeUp {
            0% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -50px); }
        }

        .hit-feedback.perfect { color: #00FFFF; /* Ciano */ }
        .hit-feedback.normal { color: #00FF00; /* Verde Lima */ }
        .hit-feedback.miss { color: #FF0000; /* Vermelho */ }
        
        /* Efeito de flash de erro */
        .error-flash {
            animation: flashRed 0.3s ease;
        }
        
        @keyframes flashRed {
            0%, 100% { background-color: #121212; }
            50% { background-color: #5d0000; }
        }

    </style>
</head>
<body>

    <div id="game-container">

        <!-- Tela Principal do Jogo -->
        <div id="game-screen">
            <!-- UI Superior -->
            <div id="ui-bar">
                <div id="score">Pontos: 0</div>
                <div id="level">Fase: 1</div>
                <div id="health">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            </div>

            <!-- √Årea do Jogo -->
            <div id="game-area">
                <!-- As 4 Trilhas (apenas visual) -->
                <div class="track"></div>
                <div class="track"></div>
                <div class="track"></div>
                <div class="track"></div>

                <!-- Zona de Acerto (cont√©m as teclas) -->
                <div id="hit-zone">
                    <div class="key" data-key="a">A</div>
                    <div class="key" data-key="s">S</div>
                    <div class="key" data-key="k">K</div>
                    <div class="key" data-key="l">L</div>
                </div>
                <!-- As notas ser√£o adicionadas aqui via JS -->
            </div>

            <!-- Barra de Progresso -->
            <div id="progress-bar-container">
                <div id="progress-bar"></div>
            </div>
        </div>

        <!-- Tela de Menu Inicial -->
        <div id="menu-screen" class="screen visible">
            <h1>HTML Hero</h1>
            <p>Aperte A, S, K, L no ritmo!</p>
            <button id="start-game-btn">Iniciar Jogo</button>
        </div>

        <!-- Tela de Fase Completa -->
        <div id="level-complete-screen" class="screen">
            <h2 id="level-complete-title">Fase 1 Completa!</h2>
            <p id="level-complete-score">Pontua√ß√£o: 0</p>
            <button id="next-level-btn">Pr√≥xima Fase</button>
        </div>

        <!-- Tela de Fim de Jogo -->
        <div id="game-over-screen" class="screen">
            <h2>Fim de Jogo!</h2>
            <p id="game-over-level">Voc√™ chegou at√© a Fase 1</p>
            <button id="retry-btn">Tentar Novamente</button>
        </div>

        <!-- Tela de Vit√≥ria Final -->
        <div id="game-complete-screen" class="screen">
            <h2>Parab√©ns!</h2>
            <p>Voc√™ completou o HTML Hero!</p>
            <p id="final-score">Pontua√ß√£o Total: 0</p>
            <button id="play-again-btn">Jogar Novamente</button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. Seletores de DOM ---
            const gameContainer = document.getElementById('game-container');
            const gameScreen = document.getElementById('game-screen');
            const gameArea = document.getElementById('game-area');
            const hitZone = document.getElementById('hit-zone');

            // Telas
            const menuScreen = document.getElementById('menu-screen');
            const levelCompleteScreen = document.getElementById('level-complete-screen');
            const gameOverScreen = document.getElementById('game-over-screen');
            const gameCompleteScreen = document.getElementById('game-complete-screen');

            // Bot√µes
            const startGameBtn = document.getElementById('start-game-btn');
            const nextLevelBtn = document.getElementById('next-level-btn');
            const retryBtn = document.getElementById('retry-btn');
            const playAgainBtn = document.getElementById('play-again-btn');

            // UI
            const scoreDisplay = document.getElementById('score');
            const levelDisplay = document.getElementById('level');
            const healthDisplay = document.getElementById('health');
            const progressBar = document.getElementById('progress-bar');
            
            // UI Telas
            const levelCompleteTitle = document.getElementById('level-complete-title');
            const levelCompleteScore = document.getElementById('level-complete-score');
            const gameOverLevel = document.getElementById('game-over-level');
            const finalScore = document.getElementById('final-score');
            
            const keys = { 'a': 0, 's': 1, 'k': 2, 'l': 3 };
            const keyElements = document.querySelectorAll('.key');

            // --- 2. Configura√ß√µes de N√≠veis (10 Fases) ---
            const levels = [
                // N√≠vel 1
                { speed: 2.5, noteCount: 20, noteInterval: 1200, music: ['C3', 'E3', 'G3'] },
                // N√≠vel 2
                { speed: 3.0, noteCount: 30, noteInterval: 1000, music: ['D3', 'F#3', 'A3'] },
                // N√≠vel 3
                { speed: 3.5, noteCount: 40, noteInterval: 900, music: ['E3', 'G#3', 'B3'] },
                // N√≠vel 4
                { speed: 4.0, noteCount: 50, noteInterval: 800, music: ['F3', 'A3', 'C4'] },
                // N√≠vel 5
                { speed: 4.5, noteCount: 60, noteInterval: 700, music: ['G3', 'B3', 'D4'] },
                // N√≠vel 6
                { speed: 5.0, noteCount: 70, noteInterval: 650, music: ['A3', 'C#4', 'E4'] },
                // N√≠vel 7
                { speed: 5.5, noteCount: 80, noteInterval: 600, music: ['B3', 'D#4', 'F#4'] },
                // N√≠vel 8
                { speed: 6.0, noteCount: 90, noteInterval: 550, music: ['C4', 'E4', 'G4'] },
                // N√≠vel 9
                { speed: 6.5, noteCount: 100, noteInterval: 500, music: ['D4', 'F#4', 'A4'] },
                // N√≠vel 10
                { speed: 7.0, noteCount: 120, noteInterval: 450, music: ['E4', 'G#4', 'B4'] }
            ];

            // --- 3. Estado do Jogo ---
            let gameState = {
                score: 0,
                level: 1,
                health: 3,
                isPlaying: false,
                notes: [],
                currentLevelConfig: {},
                notesGenerated: 0,
                gameLoopId: null,
                noteIntervalId: null,
                gameAreaHeight: 0,
                hitZoneTop: 0,
                perfectHitTop: 0,
                perfectHitBottom: 0,
                missZoneBottom: 0
            };

            // --- 4. Configura√ß√£o de √Åudio (Tone.js) ---
            let audioReady = false;
            let hitSynth, missSynth, musicLoop;

            async function setupAudio() {
                if (audioReady) return;
                try {
                    await Tone.start();
                    // Som de acerto
                    hitSynth = new Tone.Synth({
                        oscillator: { type: 'triangle' },
                        envelope: { attack: 0.01, decay: 0.1, sustain: 0.1, release: 0.1 }
                    }).toDestination();

                    // Som de erro
                    missSynth = new Tone.NoiseSynth({
                        noise: { type: 'pink' },
                        envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 }
                    }).toDestination();
                    
                    // M√∫sica de fundo (ser√° configurada por n√≠vel)
                    musicLoop = new Tone.Sequence((time, note) => {
                        hitSynth.triggerAttackRelease(note, '8n', time);
                    }, [], '4n');
                    
                    Tone.Transport.start();
                    audioReady = true;
                    console.log("√Åudio iniciado.");
                } catch (error) {
                    console.error("Erro ao iniciar √°udio:", error);
                }
            }

            // --- 5. Fun√ß√µes Principais do Jogo ---

            function init() {
                // Listeners dos bot√µes
                startGameBtn.addEventListener('click', startGame);
                nextLevelBtn.addEventListener('click', () => startLevel(gameState.level + 1));
                retryBtn.addEventListener('click', () => startLevel(gameState.level)); // Tenta o mesmo n√≠vel
                playAgainBtn.addEventListener('click', startGame);

                // Listeners do teclado
                document.addEventListener('keydown', handleKeyPress);
                document.addEventListener('keyup', handleKeyRelease);
                
                // Calcular dimens√µes (melhor fazer no resize tamb√©m, mas para simplificar)
                calculateDimensions();
            }

            function calculateDimensions() {
                gameState.gameAreaHeight = gameArea.clientHeight;
                const hitZoneRect = hitZone.getBoundingClientRect();
                const gameAreaRect = gameArea.getBoundingClientRect();

                // Posi√ß√£o Y da zona de acerto relativa √† gameArea
                gameState.hitZoneTop = hitZoneRect.top - gameAreaRect.top;
                
                // Definir zonas de acerto
                // A nota tem 40px de altura, centro em 20px
                // A zona de acerto tem 'hitZoneHeight' (100px)
                // A linha visual est√° no topo da hitZone (gameState.hitZoneTop)
                
                const noteCenterOffset = 20; // Metade da altura da nota
                
                // O "alvo" √© a linha visual (hitZoneTop)
                // Queremos que o centro da nota (note.y + 20) esteja na linha
                const targetY = gameState.hitZoneTop - noteCenterOffset;

                // Zona Perfeita: +/- 15 pixels do alvo
                gameState.perfectHitTop = targetY - 15;
                gameState.perfectHitBottom = targetY + 15;

                // Zona Normal: +/- 40 pixels do alvo
                gameState.hitZoneTop = targetY - 40;
                gameState.missZoneBottom = targetY + 40;
                
                // console.log(`Alvo Y: ${targetY}, Perfeito: ${gameState.perfectHitTop}-${gameState.perfectHitBottom}, Normal: ${gameState.hitZoneTop}-${gameState.missZoneBottom}`);
            }

            function showScreen(screenId) {
                // Esconde todas as telas
                menuScreen.classList.remove('visible');
                levelCompleteScreen.classList.remove('visible');
                gameOverScreen.classList.remove('visible');
                gameCompleteScreen.classList.remove('visible');

                // Mostra a tela de jogo principal ou a esconde
                if (screenId === 'game-screen') {
                    gameScreen.style.visibility = 'visible';
                } else {
                    gameScreen.style.visibility = 'hidden';
                    // Mostra a tela de overlay solicitada
                    document.getElementById(screenId).classList.add('visible');
                }
            }

            async function startGame() {
                await setupAudio(); // Garante que o √°udio foi iniciado pelo clique
                gameState.score = 0;
                gameState.level = 1;
                gameState.health = 3;
                startLevel(1);
            }

            function startLevel(levelIndex) {
                if (levelIndex > levels.length) {
                    endLevel(true, true); // Venceu o jogo
                    return;
                }

                // Resetar estado do n√≠vel
                gameState.level = levelIndex;
                gameState.currentLevelConfig = levels[levelIndex - 1];
                gameState.notes = [];
                gameState.notesGenerated = 0;
                if (!retryBtn.hasAttribute('disabled')) { // Se n√£o for um retry
                    gameState.health = 3; 
                }
                
                // Resetar bot√µes
                retryBtn.removeAttribute('disabled');

                // Limpar √°rea de jogo
                gameArea.querySelectorAll('.note').forEach(note => note.remove());

                updateUI();
                showScreen('game-screen');

                // Iniciar Gera√ß√£o de Notas
                gameState.noteIntervalId = setInterval(
                    generateNote,
                    gameState.currentLevelConfig.noteInterval
                );

                // Iniciar Loop do Jogo
                gameState.isPlaying = true;
                if (gameState.gameLoopId) cancelAnimationFrame(gameState.gameLoopId);
                gameState.gameLoopId = requestAnimationFrame(gameLoop);

                // Iniciar M√∫sica
                if (audioReady) {
                    musicLoop.events = gameState.currentLevelConfig.music;
                    musicLoop.start(0);
                }
            }
            
            function endLevel(didWin, isGameComplete = false) {
                gameState.isPlaying = false;
                cancelAnimationFrame(gameState.gameLoopId);
                clearInterval(gameState.noteIntervalId);
                
                if (audioReady) {
                    musicLoop.stop(0);
                }

                if (isGameComplete) {
                    finalScore.textContent = `Pontua√ß√£o Total: ${gameState.score}`;
                    showScreen('game-complete-screen');
                } else if (didWin) {
                    levelCompleteTitle.textContent = `Fase ${gameState.level} Completa!`;
                    levelCompleteScore.textContent = `Pontua√ß√£o: ${gameState.score}`;
                    showScreen('level-complete-screen');
                } else {
                    gameOverLevel.textContent = `Voc√™ chegou at√© a Fase ${gameState.level}`;
                    showScreen('game-over-screen');
                    // Desabilita o retry se for a √∫ltima vida no mesmo n√≠vel
                    retryBtn.setAttribute('disabled', 'true'); 
                }
            }

            function gameLoop(timestamp) {
                if (!gameState.isPlaying) return;

                // Mover Notas
                for (let i = gameState.notes.length - 1; i >= 0; i--) {
                    const note = gameState.notes[i];
                    note.y += gameState.currentLevelConfig.speed;
                    note.element.style.top = `${note.y}px`;

                    // Detec√ß√£o de Erro (Miss)
                    if (note.y > gameState.missZoneBottom && !note.hit) {
                        handleMiss(note);
                        gameState.notes.splice(i, 1); // Remove do array
                    }
                }

                // Verificar Fim da Fase
                if (gameState.notesGenerated >= gameState.currentLevelConfig.noteCount && gameState.notes.length === 0) {
                    endLevel(true); // Venceu o n√≠vel
                }

                // Pr√≥ximo frame
                gameState.gameLoopId = requestAnimationFrame(gameLoop);
            }

            function generateNote() {
                if (gameState.notesGenerated >= gameState.currentLevelConfig.noteCount) {
                    clearInterval(gameState.noteIntervalId); // Para de gerar
                    return;
                }

                const col = Math.floor(Math.random() * 4);
                const noteElement = document.createElement('div');
                noteElement.className = 'note';
                noteElement.dataset.col = col;
                noteElement.style.left = `${col * 25}%`;

                const noteData = {
                    element: noteElement,
                    col: col,
                    y: -40, // Posi√ß√£o inicial (altura da nota)
                    hit: false
                };

                gameState.notes.push(noteData);
                gameArea.appendChild(noteElement);
                gameState.notesGenerated++;
                
                // Atualizar barra de progresso
                const progress = (gameState.notesGenerated / gameState.currentLevelConfig.noteCount) * 100;
                progressBar.style.width = `${progress}%`;
            }

            function handleKeyPress(e) {
                if (!gameState.isPlaying) return;

                const key = e.key.toLowerCase();
                if (keys.hasOwnProperty(key)) {
                    const col = keys[key];
                    keyElements[col].classList.add('active');

                    // Buscar a nota mais baixa (mais pr√≥xima) na coluna correta
                    let hitNote = null;
                    let lowestY = -Infinity;

                    for (const note of gameState.notes) {
                        if (note.col === col && !note.hit && note.y > lowestY && note.y > (gameState.hitZoneTop - 50)) {
                            hitNote = note;
                            lowestY = note.y;
                        }
                    }

                    if (hitNote) {
                        const noteY = hitNote.y;
                        
                        // Verifica se est√° na zona de acerto (normal)
                        if (noteY > gameState.hitZoneTop && noteY < gameState.missZoneBottom) {
                            hitNote.hit = true;
                            hitNote.element.remove();
                            // Remove do array
                            gameState.notes = gameState.notes.filter(n => n !== hitNote);

                            // Verifica se foi Perfeito
                            if (noteY > gameState.perfectHitTop && noteY < gameState.perfectHitBottom) {
                                handleHit('perfect');
                            } else {
                                handleHit('normal');
                            }
                        }
                        // Se apertou, mas a nota estava fora da zona, n√£o faz nada (n√£o penaliza)
                    }
                    // Se apertou e n√£o tinha nota, n√£o faz nada (n√£o penaliza)
                }
            }
            
            function handleKeyRelease(e) {
                const key = e.key.toLowerCase();
                if (keys.hasOwnProperty(key)) {
                    keyElements[keys[key]].classList.remove('active');
                }
            }

            function handleHit(type) {
                if (type === 'perfect') {
                    gameState.score += 100;
                    showHitFeedback('Perfeito!', 'perfect');
                    if (audioReady) hitSynth.triggerAttackRelease('C5', '8n');
                } else {
                    gameState.score += 50;
                    showHitFeedback('Bom!', 'normal');
                    if (audioReady) hitSynth.triggerAttackRelease('G4', '8n');
                }
                updateUI();
            }

            function handleMiss(note) {
                note.element.remove(); // Remove a nota perdida
                gameState.health--;
                showHitFeedback('Erro!', 'miss');
                if (audioReady) missSynth.triggerAttackRelease('0.1');
                
                // Flash de erro
                gameContainer.classList.add('error-flash');
                setTimeout(() => gameContainer.classList.remove('error-flash'), 300);

                updateUI();

                if (gameState.health <= 0) {
                    endLevel(false); // Fim de jogo
                }
            }

            function updateUI() {
                scoreDisplay.textContent = `Pontos: ${gameState.score}`;
                levelDisplay.textContent = `Fase: ${gameState.level}`;
                
                const hearts = '‚ù§Ô∏è'.repeat(gameState.health) + 'üñ§'.repeat(3 - gameState.health);
                healthDisplay.textContent = hearts;
            }

            function showHitFeedback(text, type) {
                const feedback = document.createElement('div');
                feedback.className = `hit-feedback ${type}`;
                feedback.textContent = text;
                gameArea.appendChild(feedback);

                // Remove o elemento ap√≥s a anima√ß√£o
                setTimeout(() => {
                    feedback.remove();
                }, 500);
            }

            // --- 6. Iniciar o Jogo ---
            init();
        });
    </script>
</body>
</html>